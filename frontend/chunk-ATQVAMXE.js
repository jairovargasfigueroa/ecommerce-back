import{d as W}from"./chunk-XRFPBX2B.js";import{a as Re}from"./chunk-H75MTFYF.js";import{N as V,P as A,Q as Ce,R as ke,e as me}from"./chunk-PQ7QENVN.js";import{$a as ne,Ea as J,Eb as be,Fb as Me,Ga as S,Gb as ve,Hb as Se,Ib as Pe,Ja as K,Jb as we,Ka as X,Kb as xe,Lb as Ee,Mb as De,Nb as ye,Oa as Y,Ob as Ie,Pa as Z,Pb as Te,Ra as ee,Sa as te,Ta as ie,Va as oe,Wa as y,_a as I,ab as T,cb as re,db as k,eb as R,fb as ae,jb as le,kb as ce,lb as de,mb as se,pb as pe,rb as F,sb as ue,tb as fe,xb as ge,yb as he,zb as _e}from"./chunk-CC66Z2HJ.js";import{Fb as s,Pb as i,Qb as o,Rb as p,Sb as C,Tb as b,Vb as E,Yb as u,_b as v,_c as L,bd as Q,cb as w,cd as G,dc as N,dd as D,ec as O,fb as c,fc as B,gb as _,jc as $,kc as a,mc as f,oa as g,pa as h,sb as x,tc as q,xc as H,yb as d,yc as z}from"./chunk-ZV4WQW5U.js";import{c as j}from"./chunk-GAL4ENT6.js";function He(e,m){if(e&1&&(i(0,"div",20)(1,"p",21),a(2,"Previsualizaci\xF3n:"),o(),p(3,"img",22),o()),e&2){let t=v();c(3),s("src",t.previewUrl,w)}}var U=(()=>{class e{constructor(t,n,r){this.fb=t,this.dialogRef=n,this.data=r,this.isEditMode=!1,this.previewUrl=null}ngOnInit(){this.isEditMode=!!this.data,this.form=this.fb.group({nombre:[this.data?.nombre||"",S.required],descripcion:[this.data?.descripcion||"",S.required],precio:[this.data?.precio||"",S.required],stock:[this.data?.stock||"",S.required],imagen:[this.data?.imagen||""]}),this.isEditMode&&this.data.imagen&&(this.previewUrl=this.data.imagen)}onSubmit(){if(this.form.valid){let t=new FormData;for(let n in this.form.value)if(n==="imagen"){let r=this.form.value[n];r instanceof File&&t.append("imagen",r)}else t.append(n,this.form.value[n]);this.isEditMode&&t.append("id",this.data.id),this.dialogRef.close(t)}}onCancel(){this.dialogRef.close()}isCreateMode(){return!this.isEditMode}isUpdateMode(){return this.isEditMode}cargarImagen(t){console.log(t);let n=t.target;if(!n.files?.length)return;let r=n.files[0];console.log("file",r),this.form.get("imagen")?.setValue(r);let l=new FileReader;l.onload=()=>{this.previewUrl=l.result},l.readAsDataURL(r)}static{this.\u0275fac=function(n){return new(n||e)(_(ie),_(ge),_(he))}}static{this.\u0275cmp=x({type:e,selectors:[["app-producto-dialog"]],decls:42,vars:5,consts:[["inputFile",""],[1,"cardWithShadow","theme-card"],[1,"m-b-0"],[1,"scroll-container"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-lg-6"],[1,"f-w-600","m-b-8","d-block"],["appearance","outline",1,"w-100"],["matInput","","formControlName","nombre","placeholder","Nombre del producto"],["matInput","","formControlName","descripcion","placeholder","Descripci\xF3n"],["type","number","matInput","","formControlName","precio"],["type","number","matInput","","formControlName","stock"],[1,"col-lg-12","d-flex","align-items-center","justify-content-between","m-t-12"],["type","button",3,"click"],["type","file","hidden","",3,"change"],["class","preview-container",4,"ngIf"],[1,"m-t-16"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["mat-stroked-button","","color","warn","type","button",3,"click"],[1,"preview-container"],[1,"m-b-4"],["alt","Imagen del producto","width","120",3,"src"]],template:function(n,r){if(n&1){let l=E();i(0,"mat-card",1)(1,"mat-card-header")(2,"mat-card-title",2),a(3),o()(),i(4,"mat-card-content")(5,"div",3)(6,"form",4),u("ngSubmit",function(){return g(l),h(r.onSubmit())}),i(7,"div",5)(8,"div",6)(9,"mat-label",7),a(10,"Nombre"),o(),i(11,"mat-form-field",8),p(12,"input",9),o()(),i(13,"div",6)(14,"mat-label",7),a(15,"Descripci\xF3n"),o(),i(16,"mat-form-field",8),p(17,"textarea",10),o()(),i(18,"div",6)(19,"mat-label",7),a(20,"Precio"),o(),i(21,"mat-form-field",8),p(22,"input",11),o()(),i(23,"div",6)(24,"mat-label",7),a(25,"Stock"),o(),i(26,"mat-form-field",8),p(27,"input",12),o()(),i(28,"div",13)(29,"div")(30,"mat-label",7),a(31,"Imagen"),o(),i(32,"button",14),u("click",function(){g(l);let P=$(35);return h(P.click())}),a(33,"Cargar Archivo"),o(),i(34,"input",15,0),u("change",function(P){return g(l),h(r.cargarImagen(P))}),o()(),d(36,He,4,1,"div",16),o()(),i(37,"div",17)(38,"button",18),a(39),o(),i(40,"button",19),u("click",function(){return g(l),h(r.onCancel())}),a(41,"Cancelar"),o()()()()()()}n&2&&(c(3),f(" ",r.isEditMode?"Editar Producto":"Registrar Producto"," "),c(3),s("formGroup",r.form),c(30),s("ngIf",r.previewUrl),c(2),s("disabled",r.form.invalid),c(),f(" ",r.isEditMode?"Actualizar":"Registrar"," "))},dependencies:[D,L,ne,I,y,ae,R,k,T,F,ce,se,pe,de,me,oe,Y,J,Z,K,X,ee,te],styles:[".scroll-container[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto;overflow-x:hidden;padding-right:10px}.preview-container[_ngcontent-%COMP%]{max-width:100%;height:auto}.preview-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:1px solid #ccc;padding:5px;border-radius:4px}.m-t-12[_ngcontent-%COMP%]{margin-top:12px}.m-t-16[_ngcontent-%COMP%]{margin-top:16px}.m-b-4[_ngcontent-%COMP%]{margin-bottom:4px}"]})}}return e})();var ze=()=>[5,10,20];function Ue(e,m){e&1&&(i(0,"th",21),a(1," Imagen "),o())}function je(e,m){if(e&1&&(i(0,"td",22),p(1,"img",23),o()),e&2){let t=m.$implicit;c(),s("src",t.imagen,w)}}function $e(e,m){e&1&&(i(0,"th",24),a(1," Nombre "),o())}function qe(e,m){if(e&1&&(i(0,"td",22),a(1),o()),e&2){let t=m.$implicit;c(),f(" ",t.nombre," ")}}function Le(e,m){e&1&&(i(0,"th",24),a(1," Descripci\xF3n "),o())}function Qe(e,m){if(e&1&&(i(0,"td",22),a(1),o()),e&2){let t=m.$implicit;c(),f(" ",t.descripcion," ")}}function Ge(e,m){e&1&&(i(0,"th",24),a(1," Precio "),o())}function We(e,m){if(e&1&&(i(0,"td",22),a(1),H(2,"currency"),o()),e&2){let t=m.$implicit;c(),f(" ",z(2,1,t.precio)," ")}}function Je(e,m){e&1&&(i(0,"th",24),a(1," Stock "),o())}function Ke(e,m){if(e&1&&(i(0,"td",22),a(1),o()),e&2){let t=m.$implicit;c(),f(" ",t.stock," ")}}function Xe(e,m){e&1&&(i(0,"th",24),a(1," Fecha de creaci\xF3n "),o())}function Ye(e,m){if(e&1&&(i(0,"td",22),a(1),H(2,"date"),o()),e&2){let t=m.$implicit;c(),f(" ",z(2,1,t.fecha_creacion)," ")}}function Ze(e,m){e&1&&(i(0,"th",21),a(1," Acciones "),o())}function et(e,m){if(e&1){let t=E();i(0,"td",22)(1,"button",25),u("click",function(){let r=g(t).$implicit,l=v();return h(l.editarProducto(r))}),i(2,"mat-icon"),a(3,"edit"),o()(),i(4,"button",26),u("click",function(){let r=g(t).$implicit,l=v();return h(l.eliminarProducto(r.id))}),i(5,"mat-icon"),a(6,"delete"),o()()()}}function tt(e,m){e&1&&p(0,"tr",27)}function it(e,m){e&1&&p(0,"tr",28)}var Tt=(()=>{class e{constructor(t,n,r){this.apiService=t,this.dialog=n,this.router=r,this.totalRegistros=0,this.paginaActual=1,this.displayedColumns=["imagen","nombre","descripcion","precio","stock","fecha_creacion","acciones"],this.dataSource=new Te}ngOnInit(){this.getProductos()}getProductos(){let t=this.paginator.pageIndex+1;this.apiService.get("productos/",{page:t}).subscribe({next:n=>{this.dataSource.data=n.results,this.totalRegistros=n.count,console.log("Productos obtenidos:",n)},error:n=>console.error("Error al obtener productos",n)})}ngAfterViewInit(){this.getProductos(),this.paginator.page.subscribe(()=>this.getProductos())}applyFilter(t){let n=t.target.value;this.dataSource.filter=n.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}crearProducto(){this.dialog.open(U).afterClosed().subscribe(n=>{n&&this.apiService.post("productos/",n,1).subscribe(()=>this.getProductos())})}editarProducto(t){this.dialog.open(U,{width:"1000px",data:t}).afterClosed().subscribe(r=>{if(r){console.log("Producto a editadar:",r);let l=r,{id:M}=l,P=j(l,["id"]);this.apiService.put("productos",t.id,r,1).subscribe(()=>this.getProductos())}})}eliminarProducto(t){this.apiService.delete("productos",t).subscribe(()=>this.getProductos())}static{this.\u0275fac=function(n){return new(n||e)(_(Re),_(_e),_(W))}}static{this.\u0275cmp=x({type:e,selectors:[["app-productos"]],viewQuery:function(n,r){if(n&1&&(N(V,5),N(A,5)),n&2){let l;O(l=B())&&(r.paginator=l.first),O(l=B())&&(r.sort=l.first)}},decls:36,vars:7,consts:[[1,"table-wrapper"],[1,"table-header"],["appearance","outline"],["matInput","","placeholder","Buscar productos",3,"keyup"],["mat-raised-button","","color","primary",3,"click"],[1,"table-container"],["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","imagen"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombre"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","descripcion"],["matColumnDef","precio"],["matColumnDef","stock"],["matColumnDef","fecha_creacion"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"table-footer"],["showFirstLastButtons","",3,"length","pageSize","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["alt","Imagen del producto","width","50",3,"src"],["mat-header-cell","","mat-sort-header",""],["mat-icon-button","",3,"click"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,r){n&1&&(i(0,"div",0)(1,"div",1)(2,"mat-form-field",2)(3,"mat-label"),a(4,"Buscar"),o(),i(5,"input",3),u("keyup",function(M){return r.applyFilter(M)}),o()(),i(6,"div")(7,"button",4),u("click",function(){return r.crearProducto()}),a(8,"Agregar producto"),o()()(),i(9,"div",5)(10,"table",6),C(11,7),d(12,Ue,2,0,"th",8)(13,je,2,1,"td",9),b(),C(14,10),d(15,$e,2,0,"th",11)(16,qe,2,1,"td",9),b(),C(17,12),d(18,Le,2,0,"th",11)(19,Qe,2,1,"td",9),b(),C(20,13),d(21,Ge,2,0,"th",11)(22,We,3,3,"td",9),b(),C(23,14),d(24,Je,2,0,"th",11)(25,Ke,2,1,"td",9),b(),C(26,15),d(27,Xe,2,0,"th",11)(28,Ye,3,3,"td",9),b(),C(29,16),d(30,Ze,2,0,"th",8)(31,et,7,0,"td",9),b(),d(32,tt,1,0,"tr",17)(33,it,1,0,"tr",18),o()(),i(34,"div",19),p(35,"mat-paginator",20),o()()),n&2&&(c(10),s("dataSource",r.dataSource),c(22),s("matHeaderRowDef",r.displayedColumns),c(),s("matRowDefColumns",r.displayedColumns),c(2),s("length",r.totalRegistros)("pageSize",5)("pageSizeOptions",q(6,ze)))},dependencies:[D,G,Q,F,Ie,be,ve,xe,Se,Me,Ee,Pe,we,De,ye,fe,ue,k,T,re,le,ke,I,y,R,V,A,Ce],encapsulation:2})}}return e})();export{Tt as ProductosComponent};
