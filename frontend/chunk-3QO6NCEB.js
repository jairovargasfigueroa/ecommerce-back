import{a as N}from"./chunk-QSMC3UDR.js";import{d as T}from"./chunk-XRFPBX2B.js";import{a as $}from"./chunk-H75MTFYF.js";import{R as A}from"./chunk-PQ7QENVN.js";import{Ob as q,ab as E,cb as V,db as z,fb as O,kb as B,rb as D,sb as j,tb as F}from"./chunk-CC66Z2HJ.js";import{Fb as u,Pb as r,Qb as o,Rb as P,Vb as v,Yb as d,Zc as M,_b as l,_c as w,cb as h,cd as y,dd as k,fb as c,gb as g,kc as n,lc as I,mc as _,oa as m,pa as s,sb as S,xc as f,yb as b,yc as C}from"./chunk-ZV4WQW5U.js";import"./chunk-GAL4ENT6.js";function J(a,x){if(a&1){let t=v();r(0,"mat-card",4)(1,"div",5),P(2,"img",6),r(3,"div")(4,"h3",7),n(5),o(),r(6,"p"),n(7),o(),r(8,"p"),n(9),f(10,"currency"),o(),r(11,"p"),n(12),f(13,"currency"),o()()(),r(14,"div",8)(15,"button",9),d("click",function(){let e=m(t).$implicit,p=l();return s(p.agregarProducto(e))}),r(16,"mat-icon"),n(17,"add"),o()(),r(18,"button",10),d("click",function(){let e=m(t).$implicit,p=l();return s(p.quitarProducto(e))}),r(19,"mat-icon"),n(20,"remove"),o()(),r(21,"button",11),d("click",function(){let e=m(t).$implicit,p=l();return s(p.eliminarProducto(e))}),r(22,"mat-icon"),n(23,"delete"),o()()()()}if(a&2){let t=x.$implicit;c(2),u("src",t.imagen,h),c(3),I(t.nombre),c(2),_("Cantidad: ",t.cantidad,""),c(2),_("Precio unitario: ",C(10,5,t.precio),""),c(3),_("Subtotal: ",C(13,7,t.precio*t.cantidad),"")}}function R(a,x){if(a&1){let t=v();r(0,"div",12)(1,"p",13),n(2),f(3,"currency"),o(),r(4,"button",14),d("click",function(){m(t);let e=l();return s(e.irAPagar())}),n(5,"Ir a pagar"),o(),r(6,"button",15),d("click",function(){m(t);let e=l();return s(e.vaciarCarrito())}),n(7,"Vaciar carrito"),o()()}if(a&2){let t=l();c(2),_("Total: ",C(3,1,t.total),"")}}function U(a,x){a&1&&(r(0,"p"),n(1,"Tu carrito est\xE1 vac\xEDo."),o())}var nt=(()=>{class a{constructor(t,i,e){this.carritoService=t,this.api=i,this.router=e,this.carrito=[],this.total=0}ngOnInit(){let t=localStorage.getItem("carrito");this.carrito=t?JSON.parse(t):[],this.actualizarTotal()}agregarProducto(t){this.carritoService.agregarProducto(t),this.carrito=this.carritoService.obtenerCarrito(),this.actualizarTotal(),console.log("Producto agregado al carrito:",t),console.log("Carrito actual:",this.carrito)}quitarProducto(t){this.carritoService.quitarProducto(t),this.carrito=this.carritoService.obtenerCarrito(),console.log("Producto quitado del carrito:",t),console.log("Carrito actualizado:",this.carrito),this.actualizarTotal()}eliminarProducto(t){this.carritoService.eliminarProducto(t),this.carrito=this.carritoService.obtenerCarrito(),this.actualizarTotal()}vaciarCarrito(){this.carritoService.vaciarCarrito(),this.carrito=this.carritoService.obtenerCarrito(),console.log("Carrito Vacio",this.carrito),this.actualizarTotal()}actualizarTotal(){this.total=this.carrito.reduce((t,i)=>t+i.precio*i.cantidad,0)}irAPagar(){if(!localStorage.getItem("token")){localStorage.setItem("redireccionPendiente","/confirmar-pedido"),this.router.navigate(["/authentication/login"]);return}this.crearPedidoPendiente()}crearPedidoPendiente(){let i={items:this.carrito.map(e=>({producto:e.id,cantidad:e.cantidad,precio_unitario:e.precio})),estado:"pendiente",tipo_pago:"efectivo",tipo_entrega:"tienda"};console.log("Carritodelpedido",this.carrito),console.log("DatosDelPedido",i),this.carritoService.vaciarCarrito(),this.api.post("pedidos/",i).subscribe({next:e=>{console.log("Pedido creado con \xE9xito:",e),this.router.navigate(["/confirmar-pedido"])},error:e=>{console.error("Error al crear el pedido pendiente",e)}})}static{this.\u0275fac=function(i){return new(i||a)(g(N),g($),g(T))}}static{this.\u0275cmp=S({type:a,selectors:[["app-carrito"]],decls:4,vars:3,consts:[[1,"p-4","space-y-4"],["class","flex items-center justify-between p-4",4,"ngFor","ngForOf"],["class","mt-4 space-y-2",4,"ngIf"],[4,"ngIf"],[1,"flex","items-center","justify-between","p-4"],[1,"flex","items-center","gap-4"],["alt","Imagen del producto","width","80","height","80",1,"rounded","border",3,"src"],[1,"text-lg","font-semibold"],[1,"flex","flex-col","gap-2"],["mat-icon-button","","color","primary",3,"click"],["mat-icon-button","","color","accent",3,"click"],["mat-icon-button","","color","warn",3,"click"],[1,"mt-4","space-y-2"],[1,"text-xl","font-bold"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(i,e){i&1&&(r(0,"div",0),b(1,J,24,9,"mat-card",1)(2,R,8,3,"div",2)(3,U,2,0,"p",3),o()),i&2&&(c(),u("ngForOf",e.carrito),c(),u("ngIf",e.carrito.length>0),c(),u("ngIf",!e.carrito.length))},dependencies:[k,M,w,y,D,B,z,E,V,F,j,q,O,A],styles:[".carrito-container[_ngcontent-%COMP%]{padding:20px}.producto-card[_ngcontent-%COMP%]{margin-bottom:20px}.total-container[_ngcontent-%COMP%]{margin-top:20px;font-size:1.5rem;font-weight:700}"]})}}return a})();export{nt as CarritoComponent};
